{"blocks":[{"type":"codeTool","data":{"codeData":{"value":"md`# World Map (Canvas)\n\nCompare to [SVG](/@d3/world-map-svg).`","pinCode":false}}},{"type":"codeTool","data":{"codeData":{"value":"d3 = require(\"d3-geo@2\", \"d3-geo-projection@3\")","pinCode":true}}},{"type":"codeTool","data":{"codeData":{"value":"import {projectionInput} from \"@d3/projection-comparison\"","pinCode":true}}},{"type":"codeTool","data":{"codeData":{"value":"viewof projection = projectionInput({value: new URLSearchParams(location.search).get(\"projection\") || \"orthographic\"})","pinCode":true}}},{"type":"codeTool","data":{"codeData":{"value":"height = {\n  const [[x0, y0], [x1, y1]] = d3.geoPath(projection.fitWidth(width, outline)).bounds(outline);\n  const dy = Math.ceil(y1 - y0), l = Math.min(Math.ceil(x1 - x0), dy);\n  projection.scale(projection.scale() * (l - 1) / l).precision(0.2);\n  return dy;\n}","pinCode":true}}},{"type":"codeTool","data":{"codeData":{"value":"outline = ({type: \"Sphere\"})","pinCode":true}}},{"type":"codeTool","data":{"codeData":{"value":"graticule = d3.geoGraticule10()","pinCode":true}}},{"type":"codeTool","data":{"codeData":{"value":"world = FileAttachment(\"#d3/land-50m.json\").json()","pinCode":true}}},{"type":"codeTool","data":{"codeData":{"value":"land = topojson.feature(world, world.objects.land)","pinCode":true}}},{"type":"codeTool","data":{"codeData":{"value":"topojson = require(\"topojson-client@3\")","pinCode":true}}},{"type":"codeTool","data":{"codeData":{"value":"map = {\n  const context = DOM.context2d(width, height);\n  const path = d3.geoPath(projection, context);\n  context.save();\n  context.beginPath(), path(outline), context.clip(), context.fillStyle = \"#fff\", context.fillRect(0, 0, width, height);\n  context.beginPath(), path(graticule), context.strokeStyle = \"#ccc\", context.stroke();\n  context.beginPath(), path(land), context.fillStyle = \"#000\", context.fill();\n  context.restore();\n  context.beginPath(), path(outline), context.strokeStyle = \"#000\", context.stroke();\n  return context.canvas;\n}","pinCode":true}}}],"version":"2.19.1"}